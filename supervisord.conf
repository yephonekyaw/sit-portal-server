[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

[program:celery-worker]
command=/opt/venv/bin/celery -A app.celery worker --loglevel=info --concurrency=2 --max-tasks-per-child=1000
directory=/server
user=celery
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=600
killasgroup=true
priority=998
stdout_logfile=/server/logs/worker.log
stderr_logfile=/server/logs/worker-error.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
redirect_stderr=true

# Environment variables for worker
environment=PYTHONPATH="/server",PYTHONUNBUFFERED="1",PYTHONDONTWRITEBYTECODE="1"

[program:celery-beat]
command=/opt/venv/bin/celery -A app.celery beat --loglevel=info --schedule=/tmp/celerybeat-schedule
directory=/server
user=celery
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=30
killasgroup=true
priority=999
stdout_logfile=/server/logs/beat.log
stderr_logfile=/server/logs/beat-error.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
redirect_stderr=true

# Environment variables for beat
environment=PYTHONPATH="/server",PYTHONUNBUFFERED="1",PYTHONDONTWRITEBYTECODE="1"

# Group Configuration (allows starting/stopping both together)
[group:celery]
programs=celery-worker,celery-beat
priority=999